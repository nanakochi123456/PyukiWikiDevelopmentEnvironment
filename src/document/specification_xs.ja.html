<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Language" content="ja"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><title>PyukiWiki Document</title><style type="text/css">
body,td{color:black;background-color:white;margin-left:2%;margin-right:2%;font-size:100%;font-family:verdana,arial,helvetica,Sans-Serif}strong{text-shadow:inherit 0px 0px 0px;font-weight:bold}a:link{color:#215dc6;background-color:inherit;text-decoration:none}a:active{color:#215dc6;background-color:inherit;text-decoration:none}a:visited{color:#a63d21;background-color:inherit;text-decoration:none}a:hover{color:#215dc6;background-color:#CCDDEE;text-decoration:underline}h2{font-family:verdana,arial,helvetica,Sans-Serif;color:inherit;background-color:#DDEEFF;padding:.3em;border:0px;margin:0px 0px .5em 0px}h3{font-family:verdana,arial,helvetica,Sans-Serif;border-bottom:3px solid #DDEEFF;border-top:1px solid #DDEEFF;border-left:10px solid #DDEEFF;border-right:5px solid #DDEEFF;color:inherit;background-color:#FFFFFF;padding:.3em;margin:0px 0px .5em 0px}h4{font-family:verdana,arial,helvetica,Sans-Serif;border-left:18px solid #DDEEFF;color:inherit;background-color:#FFFFFF;padding:.3em;margin:0px 0px .5em 0px}font-weight:bold;background-color:transparent;padding:12px0px0px0px;border:0px;margin:12px0px0px0px}h1.error{color:red}*/ div#navigator{clear:both;padding:4px 0px 0px 0px;margin:0px}thead td.style_td,tfoot td.style_td{color:inherit;background-color:#d0d8e0}thead th.style_th,tfoot th.style_th{color:inherit;background-color:#e0e8f0}.style_table{padding:0px;border:0px;text-align:left;width:auto;margin-left:auto;margin-right:auto;color:inherit;background-color:#ccd5dd}.style_th{padding:5px;margin:1px;text-align:center;color:inherit;background-color:#eeeeee}.style_td{padding:5px;margin:1px;color:inherit;background-color:#eef5ff}
</style></head><body><p></p><p></p><h2 id="i5853B4CAB0D7BBC5CDCDBDF10">XS簡易仕様書</h2><p>現在、XSモジュールは、devel版のみのテスト実装です。</p><p></p><blockquote><blockquote><p class="quotation">&quot;PyukiWiki&quot; ver 0.2.1-customoer-preview $$<br/>Copyright (C) 2005-2015 PukiWiki Developers Team<br/>Copyright (C) 2004-2015 Nekyo (Based on PukiWiki, YukiWiki)<br/>License: GPL version 3 or (at your option) any later version<br/>and/or Artistic version 1 or later version.<br/>Based on YukiWiki <a href="http://www.hyuki.com/yukiwiki/" class="url" target="_blank" title="http://www.hyuki.com/yukiwiki/" rel="nofollow">http://www.hyuki.com/yukiwiki/</a><br/>and PukiWiki <a href="http://pukiwiki.sfjp.jp/" class="url" target="_blank" title="http://pukiwiki.sfjp.jp/" rel="nofollow">http://pukiwiki.sfjp.jp/</a><br/>URL:<br/><a href="http://pyukiwiki.info/" class="url" target="_blank" title="http://pyukiwiki.info/" rel="nofollow">http://pyukiwiki.info/</a><br/><br/>MAIL:<br/>ななみ &lt;nanami (at) daiba (dot) cx&gt; (注：バーチャル女の子です)<br/><br/>$Id$<br/>This text file written UTF-8 Codeset</p></blockquote></blockquote><p></p><div class="jumpmenu"><a href="?#navigator">&uarr;</a></div><h3 id="iCCDCBCA11">目次</h3><div class="contents"> <a id="i636F6E74656E74736"></a> <ul><li><a href="?#i5853B4CAB0D7BBC5CDCDBDF10">XS簡易仕様書</a></li><ul><li><a href="?#iCCDCBCA11">目次</a></li><li><a href="?#iBCC2C1F5CCDCC9B82">実装目標</a></li><li><a href="?#iA5A4A5F3A5B9A5C8A1BCA5EBC5F93">インストール等</a></li><li><a href="?#i7065726C205853A5E2A5B8A5E5A1BCA5EBA4CEBAEEC0AECAFDCBA14">perl XSモジュールの作成方法</a></li><li><a href="?#iA5D5A5A1A5A4A5EBC6E2CDC65">ファイル内容</a></li></ul></ul></div><p></p><div class="jumpmenu"><a href="?#navigator">&uarr;</a></div><h3 id="iBCC2C1F5CCDCC9B82">実装目標</h3>make installxs をするだけで、あとは何も考えずに、PyukiWikiが高速化する仕組みを作る<p></p><div class="jumpmenu"><a href="?#navigator">&uarr;</a></div><h3 id="iA5A4A5F3A5B9A5C8A1BCA5EBC5F93">インストール等</h3><dl class="list1"><dt>make buildxs</dt><dd>ビルドする</dd><dt>make testxs</dt><dd>テストする</dd><dt>make installxs</dt><dd>インストールをする。blibにファイルコピーをするだけです。<br/>perlモジュール側の make installは使用しないで下さい。</dd><dt>make deinstallxs</dt><dd>アンインストールをする。(blibを単純に削除するだけです。）</dd><dt>make cleanxs</dt><dd>作業ディレクトリを削除する。<br/>作業ファイル名を生成する為に、一度、perl Makefile.PL を実行します。</dd></dl><p></p><div class="jumpmenu"><a href="?#navigator">&uarr;</a></div><h3 id="i7065726C205853A5E2A5B8A5E5A1BCA5EBA4CEBAEEC0AECAFDCBA14">perl XSモジュールの作成方法</h3><pre>
cd src
h2xs -An Name::ModuleName
</pre><p></p><pre>
cd Name-ModuleName
editor ModuleName.xs（とりあえず１行書き換える）
</pre><p></p><pre>
#include &quot;ppport.h&quot;
↓
#include &quot;../xsmake/ppport.h&quot;
</pre><p></p><pre>
editor Makefile.PL （全部書き換える）
</pre><p></p><pre>
use 5.008100;
use ExtUtils::MakeMaker;
</pre><p></p><pre>
require &quot;../xsmake/pyukiwikixs.pl&quot;;
</pre><p></p><pre>
&amp;writemakefile(
	Module=&gt;&quot;Name::ModuleName&quot;,
	File=&gt;&quot;lib/Name/ModuleName.pm&quot;,
	Author=&gt;'作者',
);
</pre><p></p><div class="jumpmenu"><a href="?#navigator">&uarr;</a></div><h3 id="iA5D5A5A1A5A4A5EBC6E2CDC65">ファイル内容</h3><ul class="list1"><li>xsファイルには、可能な限りプロトタイプを指定する。</li><li>xsファイルの中には、C言語コードを最小限しか記述しない<br/>（call、jmp、ret命令相当のオーバーヘッドは出ますが、ここは気にしないで構いません）</li><li>関数の本体は、xs_funcname.c の中に記述する。</li><li>xs_funcname.c に記述できる関数名は、xs_funcname とする</li><li>その他、C言語コードは、視認性より、速度を優先して記述する。<br/></li>わかりにくい部分は、コメントで記述すると良いかもしれません。</ul></body></html>